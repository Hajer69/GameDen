<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Have fun with GameDen, Play interactive online games! Challenge yourself with Sudoku, Rock Paper Scissors, and many more games.">
    <title>GameDen - Brain Calculator</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

    <style>
        :root {
            --primary-blue: #203079;
            --primary-purple: #7C4DFF;
            --accent-orange: #FFB300;
        }
        .display-4 { color: #203079; }
        .h3 { color: #203079; }
        .bg-primary-custom {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-purple) 100%) !important;
        }
        .btn-primary-custom {
            background-color: var(--accent-orange) !important;
            border-color: var(--accent-orange) !important;
        }
        .btn-purple {
            background-color: var(--primary-purple) !important;
            border-color: var(--primary-purple) !important;
            color: white !important;
        }
        .table th{
            background: #7C4DFF;
            color: white;
            padding: 1rem;
            text-align: left;
        }
        #logo-icon { width: 40px; height: 40px; }
        h1 { color:#1f3b88; margin-top: 5%; }
    </style>
</head>

<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top shadow-sm">
    <div class="container">
        <a class="navbar-brand d-flex align-items-center fw-bold text-primary-custom" href="index.html">
            <img src="images/logo.png" id="logo-icon" alt="GameDen Logo" class="me-2">
            GameDen
        </a>

        <div class="navbar navbar-expand-sm" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link active" href="index.html">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="games.html">Games</a></li>
                <li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
                <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
                <li class="nav-item"><a class="nav-link btn btn-purple text-white ms-2" href="login.html">Sign In</a></li>
            </ul>
        </div>
    </div>
</nav>

<section class="py-5 text-center">
    <div class="container">
        <h1 class="fw-bold">Brain Calculator</h1>
        <p class="text-muted mb-0">Puzzle Difficulty Recommender - find the best brain challenge for you.</p>
    </div>
</section>

<main class="container pb-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">

            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <h2 class="h4 mb-3 text-center">Tell us about your brain session</h2>
                    <p class="text-muted text-center mb-4">
                        Enter a few details and our Brain Calculator will suggest the
                        most suitable puzzle difficulty and game type.
                    </p>

                    <form id="brainForm" method="POST" action="calculate_process.php" novalidate>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="playerName" class="form-label">Player Name</label>
                                <input type="text" class="form-control" id="playerName" name="playerName" required>
                                <div class="invalid-feedback">Please enter your name.</div>
                            </div>

                            <div class="col-md-6">
                                <label for="age" class="form-label">Age</label>
                                <input type="number" class="form-control" id="age" name="age" min="4" required>
                                <div class="invalid-feedback">Please enter a valid age (4 or above).</div>
                            </div>

                            <div class="col-md-6">
                                <label for="experience" class="form-label">Puzzle Experience</label>
                                <select class="form-select" id="experience" name="experience" required>
                                    <option value="" selected disabled>Choose...</option>
                                    <option value="beginner">Beginner</option>
                                    <option value="intermediate">Intermediate</option>
                                    <option value="expert">Expert</option>
                                </select>
                                <div class="invalid-feedback">Please select your experience level.</div>
                            </div>

                            <div class="col-md-6">
                                <label for="time" class="form-label">Time Available (minutes)</label>
                                <input type="number" class="form-control" id="time" name="time" min="5" required>
                                <div class="invalid-feedback">Please enter how many minutes you have (at least 5).</div>
                            </div>

                            <div class="col-md-12">
                                <label for="focus" class="form-label">
                                    Focus Level (1 = tired, 5 = super focused)
                                </label>
                                <input type="range" id="focus" name="focus" class="form-range" min="1" max="5" value="3">
                                <div class="d-flex justify-content-between small text-muted">
                                    <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-danger mt-3 d-none" id="formAlert">
                            Please fix the highlighted fields before running the Brain Calculator.
                        </div>

                        <div class="d-grid d-md-flex justify-content-md-end gap-2 mt-4">
                            <button type="button" class="btn btn-secondary" id="clearBtn">Clear</button>

                            <button type="submit" class="btn btn-warning fw-semibold" id="runBtn">
                                Run Brain Calculator
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card shadow-sm">
                <div class="card-body">
                    <h2 class="h5 mb-3">Recommended Puzzle Session</h2>

                    <p id="summaryText" class="text-muted">
                        Fill in the form and click <strong>Run Brain Calculator</strong> to see your
                        personalized puzzle recommendation.
                    </p>

                    <div class="row mb-2">
                        <div class="col-6 fw-semibold">Suggested Difficulty:</div>
                        <div class="col-6" id="difficultyResult">—</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-6 fw-semibold">Suggested Game Type:</div>
                        <div class="col-6" id="gameResult">—</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-6 fw-semibold">Challenge Score:</div>
                        <div class="col-6" id="scoreResult">—</div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</main>

<footer class="bg-dark text-white py-4">
    <div class="container text-center">
        <p class="mb-0">&copy; 2025 GameDen. All rights reserved.</p>
    </div>
</footer>

<script>
    const form = document.getElementById("brainForm");
    const clearBtn = document.getElementById("clearBtn");
    const formAlert = document.getElementById("formAlert");

    const difficultyResult = document.getElementById("difficultyResult");
    const gameResult = document.getElementById("gameResult");
    const scoreResult = document.getElementById("scoreResult");
    const summaryText = document.getElementById("summaryText");

    function resetValidation() {
        const inputs = form.querySelectorAll(".form-control, .form-select");
        inputs.forEach(input => input.classList.remove("is-invalid"));
        formAlert.classList.add("d-none");
    }

    // Returns true/false so we can block submit if invalid
    function runBrainCalculator() {
        resetValidation();

        const nameInput = document.getElementById("playerName");
        const ageInput = document.getElementById("age");
        const experienceInput = document.getElementById("experience");
        const timeInput = document.getElementById("time");
        const focusInput = document.getElementById("focus");

        const playerName = nameInput.value.trim();
        const age = parseInt(ageInput.value, 10);
        const time = parseInt(timeInput.value, 10);
        const experience = experienceInput.value;
        const focus = parseInt(focusInput.value, 10);

        let valid = true;

        if (playerName === "") { nameInput.classList.add("is-invalid"); valid = false; }
        if (isNaN(age) || age < 4) { ageInput.classList.add("is-invalid"); valid = false; }
        if (isNaN(time) || time < 5) { timeInput.classList.add("is-invalid"); valid = false; }
        if (!experience) { experienceInput.classList.add("is-invalid"); valid = false; }

        if (!valid) {
            formAlert.classList.remove("d-none");
            return false; // block submit
        }

        let baseFromExperience = 0;
        if (experience === "beginner") baseFromExperience = 30;
        else if (experience === "intermediate") baseFromExperience = 60;
        else if (experience === "expert") baseFromExperience = 90;

        const cappedTime = Math.min(time, 60);
        const focusFactor = focus * 5;

        let agePenalty = 0;
        if (age < 12) agePenalty = 10;
        else if (age >= 60) agePenalty = 15;

        const timeContribution = cappedTime * 2;
        const ageAdjustment = agePenalty / 2;

        const challengeScore = baseFromExperience + timeContribution + focusFactor - ageAdjustment;

        let difficultyText = "";
        let gameText = "";

        if (age < 12) {
            difficultyText = "Easy";
            gameText = "Tic Tac Toe, simple pattern games, and short memory games.";
        } else if (age >= 60 && time >= 20) {
            difficultyText = "Brain-Healthy";
            gameText = "Relaxed Sudoku, gentle memory games, and focus puzzles.";
        } else if (experience === "expert" && time >= 20 && challengeScore >= 140) {
            difficultyText = "Hard";
            gameText = "Hard Sudoku, logic grids, and advanced strategy puzzles.";
        } else if (challengeScore >= 110) {
            difficultyText = "Medium-Hard";
            gameText = "Standard Sudoku, timed memory games, and strategy puzzles.";
        } else if (challengeScore >= 80) {
            difficultyText = "Medium";
            gameText = "4x4 Sudoku, memory match games, and pattern recognition.";
        } else {
            difficultyText = "Easy";
            gameText = "Tic Tac Toe, simple riddles, and quick brain teasers.";
        }

        // UI preview BEFORE submit
        difficultyResult.textContent = difficultyText;
        gameResult.textContent = gameText;
        scoreResult.textContent = challengeScore.toFixed(1);

        summaryText.textContent =
            playerName + ", based on your age, experience, time, and focus level, " +
            "we recommend a \"" + difficultyText + "\" puzzle session. " +
            "Your Brain Calculator challenge score is " + challengeScore.toFixed(1) + ".";

        return true; //  allow submit
    }

    function clearBrainForm() {
        form.reset();
        document.getElementById("focus").value = 3;
        resetValidation();

        difficultyResult.textContent = "—";
        gameResult.textContent = "—";
        scoreResult.textContent = "—";

        summaryText.textContent =
            "Fill in the form and click \"Run Brain Calculator\" to see your personalized puzzle recommendation.";
    }

    // Block submit unless valid
    form.addEventListener("submit", function (e) {
        const ok = runBrainCalculator();
        if (!ok) {
            e.preventDefault();
            e.stopPropagation();
        }
    });

    clearBtn.addEventListener("click", clearBrainForm);

    //  After PHP redirects back, fill results from URL params
    document.addEventListener("DOMContentLoaded", () => {
        const params = new URLSearchParams(window.location.search);
        const difficulty = params.get("difficulty");
        const game = params.get("game");
        const score = params.get("score");
        const name = params.get("name");

        if (difficulty && game && score) {
            difficultyResult.textContent = difficulty;
            gameResult.textContent = game;
            scoreResult.textContent = score;

            summaryText.textContent =
                (name ? name + ", " : "") +
                `based on your age, experience, time, and focus level, we recommend a "${difficulty}" puzzle session. ` +
                `Your Brain Calculator challenge score is ${score}.`;

        }
    });
</script>

</body>
</html>
